---
import Layout from '@layouts/Layout.astro';
---

<Layout
  title="Address Validator — Orbitcheck"
  description="Free online tool for basic address format validation and structure checks."
  canonical="https://orbitcheck.io/tools/address"
>
  <main class="bg-gray-50 dark:bg-gray-900">
    <section class="max-w-3xl mx-auto px-4 py-12">
      <h1 class="text-3xl font-extrabold">Address Validator</h1>
      <p class="mt-2 text-gray-700 dark:text-gray-300">
        Basic address format and structure checks. For full validation with
        geocoding and deliverability, use the API.
      </p>
      <form
        class="bg-white border border-gray-100 rounded-lg p-6 mt-6 dark:bg-gray-800 dark:border-gray-700"
        onsubmit="return false"
      >
        <div class="space-y-4">
          <div>
            <label
              class="block text-sm font-medium text-gray-700 mb-1 dark:text-gray-300"
              for="street">Street Address</label
            >
            <input
              id="street"
              class="w-full border border-gray-300 rounded-md px-3 py-2 dark:bg-gray-700 dark:border-gray-600 dark:text-gray-100"
              placeholder="123 Main Street, Apt 4B"
            />
          </div>
          <div class="grid grid-cols-2 gap-4">
            <div>
              <label
                class="block text-sm font-medium text-gray-700 mb-1 dark:text-gray-300"
                for="city">City</label
              >
              <input
                id="city"
                class="w-full border border-gray-300 rounded-md px-3 py-2 dark:bg-gray-700 dark:border-gray-600 dark:text-gray-100"
                placeholder="Barcelona"
              />
            </div>
            <div>
              <label
                class="block text-sm font-medium text-gray-700 mb-1 dark:text-gray-300"
                for="state">State/Province</label
              >
              <input
                id="state"
                class="w-full border border-gray-300 rounded-md px-3 py-2 dark:bg-gray-700 dark:border-gray-600 dark:text-gray-100"
                placeholder="Cataluña"
              />
            </div>
          </div>
          <div class="grid grid-cols-2 gap-4">
            <div>
              <label
                class="block text-sm font-medium text-gray-700 mb-1 dark:text-gray-300"
                for="postal">Postal Code</label
              >
              <input
                id="postal"
                class="w-full border border-gray-300 rounded-md px-3 py-2 dark:bg-gray-700 dark:border-gray-600 dark:text-gray-100"
                placeholder="08001"
              />
            </div>
            <div>
              <label
                class="block text-sm font-medium text-gray-700 mb-1 dark:text-gray-300"
                for="country">Country</label
              >
              <select
                id="country"
                class="w-full border border-gray-300 rounded-md px-3 py-2 dark:bg-gray-700 dark:border-gray-600 dark:text-gray-100"
              >
                <option value="">Select country</option>
                <option value="ES">Spain</option>
                <option value="PT">Portugal</option>
                <option value="FR">France</option>
                <option value="DE">Germany</option>
                <option value="IT">Italy</option>
                <option value="GB">United Kingdom</option>
                <option value="US">United States</option>
                <option value="CA">Canada</option>
                <option value="MX">Mexico</option>
                <option value="BR">Brazil</option>
                <option value="AR">Argentina</option>
                <option value="CL">Chile</option>
                <option value="CO">Colombia</option>
              </select>
            </div>
          </div>
        </div>
        <button
          id="validate"
          class="mt-6 inline-flex items-center px-4 py-2 rounded-md bg-indigo-600 text-white hover:bg-indigo-700"
        >
          Validate
        </button>
        <div id="out" class="mt-4 text-sm text-gray-800 dark:text-gray-200">
        </div>
        <noscript>
          <div class="mt-4 text-sm text-gray-700 dark:text-gray-300">
            JavaScript disabled. Use the API:
            <pre
              class="bg-gray-900 text-gray-100 p-4 rounded-lg overflow-x-auto text-sm mt-2"><code>curl -s https://api.orbitcheck.io/v1/validate/address \
  -H "Authorization: Bearer YOUR_KEY" \
  -H "Content-Type: application/json" \
  -d '&#123;
    "street": "123 Main Street",
    "city": "Barcelona",
    "state": "Cataluña",
    "postal_code": "08001",
    "country": "ES"
  &#125;'</code></pre>
          </div>
        </noscript>
      </form>
    </section>
  </main>
</Layout>

<script>
  (function () {
    const btn = document.getElementById('validate');
    if (!btn) return;

    // Postal code patterns by country
    const postalPatterns: Record<string, { regex: RegExp; format: string }> = {
      ES: { regex: /^\d{5}$/, format: '5 digits (e.g., 08001)' },
      PT: {
        regex: /^\d{4}-\d{3}$/,
        format: '4 digits-3 digits (e.g., 1000-001)',
      },
      FR: { regex: /^\d{5}$/, format: '5 digits (e.g., 75001)' },
      DE: { regex: /^\d{5}$/, format: '5 digits (e.g., 10115)' },
      IT: { regex: /^\d{5}$/, format: '5 digits (e.g., 00100)' },
      GB: {
        regex: /^[A-Z]{1,2}\d[A-Z\d]?\s*\d[A-Z]{2}$/i,
        format: 'UK format (e.g., SW1A 1AA)',
      },
      US: {
        regex: /^\d{5}(-\d{4})?$/,
        format: '5 digits or ZIP+4 (e.g., 10001 or 10001-1234)',
      },
      CA: {
        regex: /^[A-Z]\d[A-Z]\s*\d[A-Z]\d$/i,
        format: 'Canadian format (e.g., K1A 0B1)',
      },
      MX: { regex: /^\d{5}$/, format: '5 digits (e.g., 06600)' },
      BR: { regex: /^\d{5}-?\d{3}$/, format: '8 digits (e.g., 01310-100)' },
      AR: {
        regex: /^[A-Z]\d{4}[A-Z]{3}$|^\d{4}$/i,
        format: 'CPA or 4 digits (e.g., C1425ABC or 1425)',
      },
      CL: { regex: /^\d{7}$/, format: '7 digits (e.g., 8320000)' },
      CO: { regex: /^\d{6}$/, format: '6 digits (e.g., 110111)' },
    };

    interface ValidationResult {
      valid: boolean;
      issues: string[];
      warnings: string[];
      normalized: Record<string, string>;
    }

    function validateAddress(): ValidationResult {
      const street =
        (document.getElementById('street') as HTMLInputElement)?.value.trim() ||
        '';
      const city =
        (document.getElementById('city') as HTMLInputElement)?.value.trim() ||
        '';
      const state =
        (document.getElementById('state') as HTMLInputElement)?.value.trim() ||
        '';
      const postal =
        (document.getElementById('postal') as HTMLInputElement)?.value.trim() ||
        '';
      const country =
        (document.getElementById('country') as HTMLSelectElement)?.value || '';

      const issues: string[] = [];
      const warnings: string[] = [];

      // Required fields
      if (!street) issues.push('Street address is required');
      if (!city) issues.push('City is required');
      if (!country) issues.push('Country is required');

      // Street validation
      if (street) {
        if (street.length < 5) warnings.push('Street address seems too short');
        if (street.length > 200) issues.push('Street address is too long');
        if (/^\d+$/.test(street))
          warnings.push('Street address contains only numbers');
        if (/[<>{}|\\^~\[\]`]/.test(street))
          issues.push('Street contains invalid characters');
      }

      // City validation
      if (city) {
        if (city.length < 2) issues.push('City name is too short');
        if (/\d/.test(city)) warnings.push('City name contains numbers');
      }

      // Postal code validation
      if (postal && country) {
        const pattern = postalPatterns[country];
        if (pattern && !pattern.regex.test(postal)) {
          issues.push(
            `Invalid postal code format for ${country}. Expected: ${pattern.format}`
          );
        }
      } else if (!postal && country) {
        warnings.push('Postal code is recommended for accurate delivery');
      }

      // State validation for countries that require it
      if (['US', 'CA', 'MX', 'BR', 'AR'].includes(country) && !state) {
        warnings.push('State/Province is recommended for this country');
      }

      // Normalize output
      const normalized: Record<string, string> = {};
      if (street) normalized.street = street;
      if (city) normalized.city = city;
      if (state) normalized.state = state;
      if (postal)
        normalized.postal_code = postal.toUpperCase().replace(/\s+/g, ' ');
      if (country) normalized.country = country;

      return {
        valid: issues.length === 0,
        issues,
        warnings,
        normalized,
      };
    }

    btn.addEventListener('click', function () {
      const out = document.getElementById('out');
      if (!out) return;

      const result = validateAddress();

      let html = '';
      if (result.valid) {
        html +=
          '<div class="p-3 bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg mb-3">';
        html +=
          '<span class="text-green-700 dark:text-green-300">✅ Address format looks valid</span>';
        html += '</div>';
      } else {
        html +=
          '<div class="p-3 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg mb-3">';
        html +=
          '<span class="text-red-700 dark:text-red-300">❌ Issues found:</span>';
        html +=
          '<ul class="mt-1 ml-4 list-disc text-red-600 dark:text-red-400">';
        result.issues.forEach((issue) => {
          html += `<li>${issue}</li>`;
        });
        html += '</ul></div>';
      }

      if (result.warnings.length > 0) {
        html +=
          '<div class="p-3 bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg mb-3">';
        html +=
          '<span class="text-yellow-700 dark:text-yellow-300">⚠️ Warnings:</span>';
        html +=
          '<ul class="mt-1 ml-4 list-disc text-yellow-600 dark:text-yellow-400">';
        result.warnings.forEach((warning) => {
          html += `<li>${warning}</li>`;
        });
        html += '</ul></div>';
      }

      html += '<div class="p-3 bg-gray-50 dark:bg-gray-700 rounded-lg">';
      html += '<span class="font-medium">Normalized:</span>';
      html +=
        '<pre class="mt-1 text-xs overflow-x-auto"><code>' +
        JSON.stringify(result.normalized, null, 2) +
        '</code></pre>';
      html += '</div>';

      html += '<p class="mt-3 text-xs text-gray-500 dark:text-gray-400">';
      html +=
        'This is a basic format check. For full validation with geocoding, deliverability scoring, and normalization, use the <a href="/docs#address-validation" class="text-indigo-600 hover:text-indigo-700 underline">Orbitcheck API</a>.';
      html += '</p>';

      out.innerHTML = html;
    });
  })();
</script>
